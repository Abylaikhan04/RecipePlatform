<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TÃ¡tti-DÃ¡m - Share & Discover Recipes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Arial', sans-serif;
            background-color: #F9FAFB;
            color: #1F2937;
        }

        /* Recipe Card */
        .recipe-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        /* Search Bar */
        .search-bar:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.3);
        }

        /* Category Buttons */
        .category-btn.active {
            background-color: #FD5719;
            color: white;
        }

        /* Modal and Panel Transitions */
        .modal, .notification-panel, .message-panel, .modal-overlay, .notification-overlay, .message-overlay {
            transition: opacity 0.3s ease, visibility 0.3s ease;
            opacity: 0;
            visibility: hidden;
        }
        .modal-content, .notification-panel, .message-panel {
            transition: transform 0.3s ease;
            transform: translateY(20px);
        }
        .modal.active, .notification-panel.active, .message-panel.active,
        .modal-overlay.active, .notification-overlay.active, .message-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal.active .modal-content, 
        .notification-panel.active, 
        .message-panel.active {
            transform: translateY(0);
        }

        /* Spinner */
        .pin-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Gradient Text */
        .gradient-text {
            background: linear-gradient(45deg, #FD5719, #FF8C00);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* Toast Notification */
        .toast {
            transition: all 0.3s ease;
        }
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        .toast.hide {
            opacity: 0;
            transform: translateY(20px);
        }

        /* Dropzone */
        .dropzone {
            transition: all 0.3s ease;
        }
        .dropzone.active {
            border-color: #FD5719;
            background-color: #FEF2F2;
        }

        /* Saved Icon */
        .saved {
            color: #FD5719 !important;
        }

        /* Overlays */
        .modal-overlay, .notification-overlay, .message-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 998;
        }

        /* Notification Panel */
        .notification-panel {
            position: fixed;
            top: 10%;
            left: 39%;
            width: 400px;
            max-width: 90%;
            max-height: 80vh;
            background: white;
            border-radius: 12px;
            padding: 24px;
            z-index: 999;
            overflow-y: auto;
        }
        .notification-panel h1 {
            color: #1F2937;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 1.5rem;
            position: relative;
        }
        .notification-badge {
            position: absolute;
            top: -8px;
            right: 0;
            background: #FD5719;
            color: #FFF;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        .notification-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 16px;
            padding: 12px;
            border-radius: 8px;
            transition: background 0.2s ease;
            cursor: pointer;
        }
        .notification-item:hover {
            background: #F9FAFB;
        }
        .notification-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        .notification-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .notification-text {
            color: #1F2937;
            font-size: 0.875rem;
            line-height: 1.25rem;
        }
        .notification-comment {
            color: #6B7280;
            font-size: 0.75rem;
        }
        .notification-time {
            color: #6B7280;
            font-size: 0.75rem;
        }
        .notification-image {
            width: 60px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
        }
        .notification-options-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            color: #6B7280;
            font-size: 1rem;
        }
        .notification-options-menu {
            position: absolute;
            right: 12px;
            top: 32px;
            background: #FFF;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-radius: 8px;
            padding: 8px 0;
            z-index: 10;
            display: none;
        }
        .notification-options-menu button {
            display: block;
            width: 100%;
            padding: 6px 12px;
            background: none;
            border: none;
            text-align: left;
            cursor: pointer;
            font-size: 0.875rem;
            color: #1F2937;
        }
        .notification-options-menu button:hover {
            background: #F9FAFB;
        }
        .notification-options-menu button.remove {
            color: #FD5719;
        }
        .notification-options-menu button.remove:hover {
            background: #FEF2F2;
        }
        .section-title {
            color: #1F2937;
            font-size: 1.125rem;
            font-weight: 500;
            margin-bottom: 12px;
        }

        /* Message Panel */
        .message-panel {
            position: fixed;
            top: 10%;
            left: 23%;
            width: 80%;
            max-width: 1000px;
            height: 80vh;
            background: white;
            border-radius: 12px;
            z-index: 999;
            overflow: hidden;
        }
        .message-container {
            display: flex;
            height: 100%;
        }
        .message-sidebar {
            width: 300px;
            background: #FFF;
            border-right: 1px solid #E5E7EB;
            overflow-y: auto;
        }
        .message-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #F9FAFB;
        }
        .message-search {
            padding: 16px;
            background: #FFF;
        }
        .message-search input {
            width: 100%;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #E5E7EB;
            font-size: 0.875rem;
        }
        .message-list {
            padding: 8px;
        }
        .message-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #FFF;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        .message-item:hover {
            background: #F9FAFB;
        }
        .message-item.active {
            background: #FEF2F2;
        }
        .message-item.active:hover {
            background: #FEF2F2;
        }
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
            background-size: cover;
            background-position: center;
        }
        .message-info {
            flex: 1;
        }
        .message-name {
            font-weight: 600;
            color: #1F2937;
            font-size: 0.875rem;
        }
        .message-preview {
            color: #6B7280;
            font-size: 0.75rem;
        }
        .message-meta {
            text-align: right;
        }
        .message-time {
            color: #6B7280;
            font-size: 0.75rem;
        }
        .message-unread {
            background: #FD5719;
            color: #FFF;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            margin-top: 4px;
        }
        .message-header {
            padding: 16px;
            background: #FFF;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #E5E7EB;
        }
        .message-user-info {
            display: flex;
            align-items: center;
        }
        .message-user-name {
            font-weight: 600;
            color: #1F2937;
            margin-left: 12px;
            font-size: 1rem;
        }
        .message-chat {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .no-chat-selected {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: #6B7280;
        }
        .message-bubble {
            max-width: 70%;
            margin-bottom: 8px;
            padding: 8px 12px;
            border-radius: 12px;
            position: relative;
            font-size: 0.875rem;
        }
        .own-message {
            align-self: flex-end;
            background: #FD5719;
            color: #FFF;
            border-bottom-right-radius: 4px;
        }
        .other-message {
            align-self: flex-start;
            background: #FFF;
            color: #1F2937;
            border-bottom-left-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .message-text {
            word-wrap: break-word;
        }
        .message-media {
            max-width: 100%;
            max-height: 150px;
            border-radius: 8px;
            margin-bottom: 4px;
            display: block;
        }
        .message-timestamp {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 4px;
            text-align: right;
        }
        .message-input {
            padding: 12px;
            background: #FFF;
            display: flex;
            align-items: center;
            border-top: 1px solid #E5E7EB;
        }
        .message-input input {
            flex: 1;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #E5E7EB;
            margin-right: 8px;
            font-size: 0.875rem;
        }
        .message-send-btn {
            padding: 8px 16px;
            background: #FD5719;
            color: #FFF;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
        }
        .message-send-btn:disabled {
            background: #D1D5DB;
            cursor: not-allowed;
        }
        .message-media-btn {
            background: none;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            margin-right: 8px;
            color: #6B7280;
        }

        /* Enhanced Create Recipe Modal */
        .create-recipe-modal {
            max-height: 90vh;
            overflow-y: auto;
            width: 90%;
            max-width: 800px;
        }
        .ingredient-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .ingredient-input {
            flex: 1;
            margin-right: 8px;
        }
        .remove-ingredient {
            color: #FD5719;
            cursor: pointer;
            font-size: 1.2rem;
        }
        .add-ingredient {
            color: #FD5719;
            cursor: pointer;
            font-size: 1.2rem;
            margin-top: 8px;
        }
        .modal-footer {
            position: sticky;
            bottom: 0;
            background: white;
            padding-top: 16px;
            padding-bottom: 16px;
        }

        /* Filter Ingredient Item */
        .filter-ingredient-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .filter-ingredient-input {
            flex: 1;
            margin-right: 8px;
        }
        .remove-filter-ingredient {
            color: #FD5719;
            cursor: pointer;
            font-size: 1.2rem;
        }
        .add-filter-ingredient {
            color: #FD5719;
            cursor: pointer;
            font-size: 1.2rem;
            margin-top: 8px;
        }

        /* Filter Button */
        #filter-btn {
            transition: color 0.2s ease;
        }

        /* Active Filters */
        .filter-tag {
            display: inline-flex;
            align-items: center;
            background: #FEF2F2;
            color: #FD5719;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-right: 4px;
            margin-bottom: 4px;
        }
        .filter-tag .remove-filter {
            margin-left: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        /* Filter Modal */
        #filter-modal .modal-content {
            max-height: 80vh;
            overflow-y: auto;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .message-panel {
                width: 95%;
                height: 90vh;
            }
            .message-sidebar {
                width: 100%;
                display: none;
            }
            .message-content {
                width: 100%;
            }
            .notification-panel {
                width: 95%;
            }
            .create-recipe-modal {
                width: 95%;
            }
            .search-bar {
                width: 150px !important;
            }
        }
        @media (max-width: 640px) {
            .search-bar {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <span class="fas fa-utensils text-red-500 text-2xl mr-2" style="color: #FD5719;" role="img" aria-hidden="true"></span>
                        <a href="Index.html"><span class="text-xl font-bold gradient-text">TÃ¡tti-DÃ¡m</span></a>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="relative mx-4 w-64 md:w-96">
                        <input type="text" placeholder="Search recipes..." 
                            class="search-bar w-full pl-10 pr-10 py-2 rounded-full border border-gray-300 focus:border-red-400 focus:ring-0" aria-label="Search recipes">
                        <span class="fas fa-search absolute left-3 top-3 text-gray-400" role="img" aria-hidden="true"></span>
                        <button id="filter-btn" class="absolute right-3 top-3 text-gray-400 hover:text-red-500" aria-label="Filter recipes">
                            <span class="fas fa-filter" role="img" aria-hidden="true"></span>
                        </button>
                    </div>
                    <button id="create-btn" class="hidden md:block bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-full font-medium transition" aria-label="Create recipe">
                        <span class="fas fa-plus mr-2" role="img" aria-hidden="true"></span> Create
                    </button>
                    <button id="notification-btn" class="ml-4 relative text-gray-500 hover:text-red-500" aria-label="Notifications">
                        <span class="fas fa-bell text-xl" role="img" aria-hidden="true"></span>
                        <span class="notification-badge absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 flex items-center justify-center rounded-full">5</span>
                    </button>
                    <button id="message-btn" class="ml-4 text-gray-500 hover:text-red-500" aria-label="Messages">
                        <span class="fas fa-envelope text-xl" role="img" aria-hidden="true"></span>
                    </button>
                    <div class="ml-4 flex items-center">
                        <div class="relative">
                            <button id="user-menu" class="flex items-center focus:outline-none" aria-label="User menu" aria-haspopup="true">
                                <img class="h-8 w-8 rounded-full" src="https://randomuser.me/api/portraits/women/44.jpg" alt="User profile">
                                <span class="fas fa-chevron-down ml-1 text-gray-500 text-xs" role="img" aria-hidden="true"></span>
                            </button>
                            <div id="user-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50">
                                <a href="User-Profile.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Profile</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Saved Recipes</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Settings</a>
                                <div class="border-t border-gray-200"></div>
                                <a href="index.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Sign out</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Categories -->
        <div class="mb-8 overflow-x-auto">
            <div class="flex space-x-2 pb-2" role="tablist">
                <button data-category="all" class="category-btn active px-4 py-2 rounded-full bg-gray-100 text-gray-800 font-medium text-sm whitespace-nowrap" role="tab" aria-selected="true">
                    All Recipes
                </button>
                <button data-category="breakfast" class="category-btn px-4 py-2 rounded-full bg-gray-100 text-gray-800 font-medium text-sm whitespace-nowrap" role="tab" aria-selected="false">
                    <span class="fas fa-egg mr-1" role="img" aria-hidden="true"></span> Breakfast
                </button>
                <button data-category="lunch" class="category-btn px-4 py-2 rounded-full bg-gray-100 text-gray-800 font-medium text-sm whitespace-nowrap" role="tab" aria-selected="false">
                    <span class="fas fa-hamburger mr-1" role="img" aria-hidden="true"></span> Lunch
                </button>
                <button data-category="dinner" class="category-btn px-4 py-2 rounded-full bg-gray-100 text-gray-800 font-medium text-sm whitespace-nowrap" role="tab" aria-selected="false">
                    <span class="fas fa-drumstick-bite mr-1" role="img" aria-hidden="true"></span> Dinner
                </button>
                <button data-category="desserts" class="category-btn px-4 py-2 rounded-full bg-gray-100 text-gray-800 font-medium text-sm whitespace-nowrap" role="tab" aria-selected="false">
                    <span class="fas fa-ice-cream mr-1" role="img" aria-hidden="true"></span> Desserts
                </button>
                <button data-category="vegan" class="category-btn px-4 py-2 rounded-full bg-gray-100 text-gray-800 font-medium text-sm whitespace-nowrap" role="tab" aria-selected="false">
                    <span class="fas fa-leaf mr-1" role="img" aria-hidden="true"></span> Vegan
                </button>
                <button data-category="quick" class="category-btn px-4 py-2 rounded-full bg-gray-100 text-gray-800 font-medium text-sm whitespace-nowrap" role="tab" aria-selected="false">
                    <span class="fas fa-bolt mr-1" role="img" aria-hidden="true"></span> Quick Meals
                </button>
            </div>
            <div id="active-filters" class="flex flex-wrap gap-2 mt-2"></div>
        </div>

        <!-- Recipe Grid -->
        <div id="recipe-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            <!-- Recipe cards will be loaded here -->
        </div>

        <!-- Infinite Scroll Root -->
        <div id="infinite-scroll-root" class="h-10"></div>
    </main>

    <!-- Filter Modal -->
    <div id="filter-modal" class="modal modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="modal-content bg-white rounded-xl w-full max-w-md mx-4 p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">Filter Recipes</h3>
                <button id="close-filter-modal" class="text-gray-500 hover:text-gray-700" aria-label="Close filter modal">
                    <span class="fas fa-times" role="img" aria-hidden="true"></span>
                </button>
            </div>
            <form id="filter-form">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2">
                        Ingredients (max 10)
                    </label>
                    <div id="filter-ingredients-container">
                        <div class="filter-ingredient-item">
                            <input type="text" name="filter-ingredient" placeholder="e.g., avocado"
                                class="filter-ingredient-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                            <span class="fas fa-times remove-filter-ingredient hidden" role="button" aria-label="Remove ingredient"></span>
                        </div>
                    </div>
                    <span class="fas fa-plus-circle add-filter-ingredient" role="button" aria-label="Add ingredient"></span>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="filter-rating">
                        Minimum Rating
                    </label>
                    <select id="filter-rating" name="filter-rating"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                        <option value="0">Any</option>
                        <option value="4.0">4.0+</option>
                        <option value="4.5">4.5+</option>
                        <option value="4.8">4.8+</option>
                    </select>
                </div>
                <div class="flex justify-end">
                    <button type="button" id="clear-filters" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md mr-2 hover:bg-gray-300" aria-label="Clear filters">
                        Clear
                    </button>
                    <button type="submit" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600" aria-label="Apply filters">
                        Apply
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Recipe Modal -->
    <div id="create-modal" class="modal modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="modal-content bg-white rounded-xl w-full max-w-4xl mx-4 create-recipe-modal">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">Share Your Recipe</h3>
                    <button id="close-modal" class="text-gray-500 hover:text-gray-700" aria-label="Close modal">
                        <span class="fas fa-times" role="img" aria-hidden="true"></span>
                    </button>
                </div>
                <form id="recipe-form">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2" for="recipe-name">
                            Recipe Name
                        </label>
                        <input type="text" id="recipe-name" name="recipe-name" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" aria-required="true">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2" for="recipe-description">
                            Description
                        </label>
                        <textarea id="recipe-description" name="recipe-description" rows="3" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" aria-required="true"></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-2" for="prep-time">
                                Preparation Time
                            </label>
                            <input type="text" id="prep-time" name="prep-time" placeholder="e.g., 15min" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" aria-required="true">
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-2" for="cook-time">
                                Cooking Time
                            </label>
                            <input type="text" id="cook-time" name="cook-time" placeholder="e.g., 20min" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" aria-required="true">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-2" for="recipe-calories">
                                Calories (per serving)
                            </label>
                            <input type="number" id="recipe-calories" name="recipe-calories" placeholder="e.g., 350" min="0"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-2" for="recipe-difficulty">
                                Difficulty Level
                            </label>
                            <select id="recipe-difficulty" name="recipe-difficulty"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                                <option value="easy">Easy</option>
                                <option value="medium">Medium</option>
                                <option value="hard">Hard</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">
                            Ingredients (max 50)
                        </label>
                        <div id="ingredients-container">
                            <div class="ingredient-item">
                                <input type="text" name="ingredient" placeholder="e.g., 2 cups flour" 
                                    class="ingredient-input px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" aria-required="true">
                                <span class="fas fa-times remove-ingredient" role="button" aria-label="Remove ingredient"></span>
                            </div>
                        </div>
                        <span class="fas fa-plus-circle add-ingredient" role="button" aria-label="Add ingredient"></span>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2" for="recipe-category">
                            Category
                        </label>
                        <select id="recipe-category" name="recipe-category" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" aria-required="true">
                            <option value="breakfast">Breakfast</option>
                            <option value="lunch">Lunch</option>
                            <option value="dinner">Dinner</option>
                            <option value="desserts">Dessert</option>
                            <option value="vegan">Vegan</option>
                            <option value="quick">Quick Meals</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">
                            Upload Photo
                        </label>
                        <div id="dropzone" class="border-2 border-dashed border-gray-300 rounded-md p-6 text-center dropzone">
                            <span class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2" role="img" aria-hidden="true"></span>
                            <p class="text-gray-500">Drag & drop your photo here or click to browse</p>
                            <input type="file" id="recipe-image" name="recipe-image" class="hidden" accept="image/*">
                        </div>
                        <div id="image-preview" class="hidden mt-2">
                            <img id="preview-image" src="#" alt="Preview" class="max-h-40 mx-auto rounded-md">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">
                            Upload Tutorial Video
                        </label>
                        <div id="video-dropzone" class="border-2 border-dashed border-gray-300 rounded-md p-6 text-center dropzone">
                            <span class="fas fa-video text-3xl text-gray-400 mb-2" role="img" aria-hidden="true"></span>
                            <p class="text-gray-500">Drag & drop your video here or click to browse</p>
                            <input type="file" id="tutorial-video" name="tutorial-video" class="hidden" accept="video/*">
                        </div>
                        <div id="video-preview" class="hidden mt-2">
                            <video id="video-preview-element" controls class="max-h-40 mx-auto rounded-md"></video>
                        </div>
                    </div>
                    <div class="modal-footer flex justify-end">
                        <button type="button" id="cancel-recipe" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md mr-2 hover:bg-gray-300" aria-label="Cancel">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600" aria-label="Share recipe">
                            Share Recipe
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Notification Overlay and Panel -->
    <div class="notification-overlay" id="notificationOverlay"></div>
    <div class="notification-panel" id="notificationPanel">
        <h1>Notifications </h1>
        <div class="notification-section">
            <h2 class="section-title">Recent</h2>
            <div id="recentNotifications"></div>
        </div>
        <div class="notification-section" style="margin-top: 24px;">
            <h2 class="section-title">Earlier</h2>
            <div id="earlierNotifications"></div>
        </div>
    </div>

    <!-- Message Overlay and Panel -->
    <div class="message-overlay" id="messageOverlay"></div>
    <div class="message-panel" id="messagePanel">
        <div class="message-container">
            <div class="message-sidebar">
                <div class="message-search">
                    <input type="text" id="message-search" placeholder="Search" aria-label="Search messages">
                </div>
                <div class="message-list" id="message-list">
                    <!-- Chat list will be populated dynamically -->
                </div>
            </div>
            <div class="message-content">
                <div class="message-header" id="messageHeader">
                    <div class="message-user-info">
                        <div class="message-avatar" id="message-avatar"></div>
                        <div class="message-user-name" id="message-user-name">Select a chat</div>
                    </div>
                </div>
                <div class="message-chat" id="messageChat">
                    <div class="no-chat-selected">Who would you like to message?</div>
                </div>
                <div class="message-input">
                    <input type="file" id="mediaInput" accept="image/*,video/*" style="display: none;">
                    <button class="message-media-btn" id="message-media-btn" aria-label="Attach media">ðŸ“Ž</button>
                    <input type="text" id="messageTextInput" placeholder="Message..." aria-label="Message input">
                    <button class="message-send-btn" id="message-send-btn" disabled aria-label="Send message">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-4 py-2 rounded-md shadow-lg opacity-0">
        <span id="toast-message"></span>
    </div>

    <script>
        // Recipe data
        const recipes = [
            {
                src: "Recipe-Details.html",
                id: 1,
                name: "Avocado Toast with Poached Egg",
                description: "Creamy avocado on toasted sourdough with perfectly poached eggs and chili flakes.",
                image: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&w=880&q=80",
                time: "15 min",
                calories: "320 cal",
                category: "breakfast",
                difficulty: "easy",
                rating: 4.5,
                ingredients: ["2 slices sourdough", "1 avocado", "2 eggs", "Chili flakes", "Salt", "Pepper"],
                user: { name: "Sarah Johnson", avatar: "https://randomuser.me/api/portraits/women/12.jpg" },
                saved: false,
                prepTime: "10min",
                cookTime: "5min"
            },
            {
                id: 2,
                name: "Rainbow Buddha Bowl",
                description: "Colorful bowl packed with quinoa, roasted veggies, avocado and tahini dressing.",
                image: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?auto=format&fit=crop&w=880&q=80",
                time: "25 min",
                calories: "450 cal",
                category: "lunch",
                difficulty: "medium",
                rating: 4.7,
                ingredients: ["1 cup quinoa", "1 avocado", "Mixed veggies", "Tahini", "Lemon juice"],
                user: { name: "Michael Chen", avatar: "https://randomuser.me/api/portraits/men/32.jpg" },
                saved: false,
                prepTime: "15min",
                cookTime: "10min"
            },
            {
                id: 3,
                name: "Homemade Margherita Pizza",
                description: "Classic pizza with fresh mozzarella, basil, and San Marzano tomato sauce.",
                image: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?auto=format&fit=crop&w=880&q=80",
                time: "40 min",
                calories: "680 cal",
                category: "dinner",
                difficulty: "medium",
                rating: 4.8,
                ingredients: ["Pizza dough", "Mozzarella", "Basil", "Tomato sauce", "Olive oil"],
                user: { name: "Emma Wilson", avatar: "https://randomuser.me/api/portraits/women/45.jpg" },
                saved: false,
                prepTime: "20min",
                cookTime: "20min"
            },
            {
                id: 4,
                name: "Fluffy Blueberry Pancakes",
                description: "Light and fluffy pancakes bursting with fresh blueberries and maple syrup.",
                image: "https://images.unsplash.com/photo-1484723091739-30a097e8f929?auto=format&fit=crop&w=880&q=80",
                time: "20 min",
                calories: "380 cal",
                category: "breakfast",
                difficulty: "easy",
                rating: 4.8,
                ingredients: ["1 cup flour", "1 cup milk", "1 egg", "Blueberries", "Maple syrup"],
                user: { name: "David Kim", avatar: "https://randomuser.me/api/portraits/men/22.jpg" },
                saved: false,
                prepTime: "10min",
                cookTime: "10min"
            },
            {
                id: 5,
                name: "Creamy Garlic Mushroom Pasta",
                description: "Rich and creamy pasta with sautÃ©ed mushrooms, garlic, and parmesan.",
                image: "https://images.unsplash.com/photo-1544025162-d76694265947?auto=format&fit=crop&w=880&q=80",
                time: "25 min",
                calories: "520 cal",
                category: "dinner",
                difficulty: "medium",
                rating: 4.6,
                ingredients: ["200g pasta", "Mushrooms", "Garlic", "Cream", "Parmesan"],
                user: { name: "Olivia Martinez", avatar: "https://randomuser.me/api/portraits/women/33.jpg" },
                saved: false,
                prepTime: "10min",
                cookTime: "15min"
            },
            {
                id: 6,
                name: "Tropical Green Smoothie",
                description: "Refreshing blend of spinach, mango, pineapple, banana and coconut water.",
                image: "https://images.unsplash.com/photo-1518779578993-ec3579fee39f?auto=format&fit=crop&w=880&q=80",
                time: "5 min",
                calories: "210 cal",
                category: "quick",
                difficulty: "easy",
                rating: 4.9,
                ingredients: ["Spinach", "Mango", "Pineapple", "Banana", "Coconut water"],
                user: { name: "Sophia Lee", avatar: "https://randomuser.me/api/portraits/women/28.jpg" },
                saved: false,
                prepTime: "5min",
                cookTime: "0min"
            },
            {
                id: 7,
                name: "Honey Garlic Glazed Salmon",
                description: "Perfectly cooked salmon with a sweet and savory honey garlic glaze.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?auto=format&fit=crop&w=880&q=80",
                time: "20 min",
                calories: "350 cal",
                category: "dinner",
                difficulty: "medium",
                rating: 4.7,
                ingredients: ["Salmon fillet", "Honey", "Garlic", "Soy sauce", "Lemon"],
                user: { name: "James Wilson", avatar: "https://randomuser.me/api/portraits/men/45.jpg" },
                saved: false,
                prepTime: "10min",
                cookTime: "10min"
            },
            {
                id: 8,
                name: "Mediterranean Chicken Skewers",
                description: "Juicy chicken marinated in lemon, garlic and herbs, grilled to perfection.",
                image: "https://images.unsplash.com/photo-1606787366850-de6330128bfc?auto=format&fit=crop&w=880&q=80",
                time: "30 min",
                calories: "290 cal",
                category: "lunch",
                difficulty: "medium",
                rating: 4.6,
                ingredients: ["Chicken breast", "Lemon", "Garlic", "Herbs", "Olive oil"],
                user: { name: "Ava Thompson", avatar: "https://randomuser.me/api/portraits/women/19.jpg" },
                saved: false,
                prepTime: "15min",
                cookTime: "15min"
            }
        ];
    
        // Notification data
        const notifications = [
            {
                id: 1,
                type: 'like',
                user: { name: 'Sarah Johnson', avatar: 'https://randomuser.me/api/portraits/women/12.jpg' },
                text: 'Sarah liked your recipe "Avocado Toast with Poached Egg"',
                time: '5m ago',
                image: 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&w=880&q=80',
                recent: true
            },
            {
                id: 2,
                type: 'comment',
                user: { name: 'Michael Chen', avatar: 'https://randomuser.me/api/portraits/men/32.jpg' },
                text: 'Michael commented on your recipe',
                comment: 'This looks amazing! Can\'t wait to try it.',
                time: '10m ago',
                recent: true
            },
            {
                id: 3,
                type: 'follow',
                user: { name: 'Emma Wilson', avatar: 'https://randomuser.me/api/portraits/women/45.jpg' },
                text: 'Emma started following you',
                time: '1h ago',
                recent: true
            },
            {
                id: 4,
                type: 'like',
                user: { name: 'David Kim', avatar: 'https://randomuser.me/api/portraits/men/22.jpg' },
                text: 'David liked your recipe "Rainbow Buddha Bowl"',
                time: 'Yesterday',
                image: 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?auto=format&fit=crop&w=880&q=80',
                recent: false
            },
            {
                id: 5,
                type: 'comment',
                user: { name: 'Olivia Martinez', avatar: 'https://randomuser.me/api/portraits/women/33.jpg' },
                text: 'Olivia commented on your recipe',
                comment: 'So delicious! Thanks for sharing.',
                time: '2 days ago',
                recent: false
            }
        ];
    
        // Message data
        const messages = [
            {
                id: 1,
                user: { name: 'Shakhzada', avatar: 'https://randomuser.me/api/portraits/women/44.jpg' },
                preview: 'Hey, loved your pizza recipe!',
                time: '10:30 AM',
                unread: 2,
                chat: [
                    { text: 'Hey, loved your pizza recipe!', timestamp: '10:28 AM', own: false },
                    { text: 'Thanks! Glad you liked it.', timestamp: '10:30 AM', own: true }
                ]
            },
            {
                id: 2,
                user: { name: 'Michael Chen', avatar: 'https://randomuser.me/api/portraits/men/32.jpg' },
                preview: 'Can you share the smoothie recipe?',
                time: '9:15 AM',
                unread: 1,
                chat: [
                    { text: 'Can you share the smoothie recipe?', timestamp: '9:15 AM', own: false }
                ]
            }
        ];
    
        // State variables
        let state = {
            currentCategory: 'all',
            displayedRecipes: 8,
            filteredRecipes: [...recipes],
            newRecipeId: 9,
            selectedChatId: null,
            searchIngredients: [],
            minRating: 0
        };
    
        // DOM Elements
        const recipeGrid = document.getElementById('recipe-grid');
        const infiniteScrollRoot = document.getElementById('infinite-scroll-root');
        const userMenu = document.getElementById('user-menu');
        const userDropdown = document.getElementById('user-dropdown');
        const categoryBtns = document.querySelectorAll('.category-btn');
        const createBtn = document.getElementById('create-btn');
        const notificationBtn = document.getElementById('notification-btn');
        const messageBtn = document.getElementById('message-btn');
        const createModal = document.getElementById('create-modal');
        const closeModal = document.getElementById('close-modal');
        const cancelRecipe = document.getElementById('cancel-recipe');
        const recipeForm = document.getElementById('recipe-form');
        const dropzone = document.getElementById('dropzone');
        const recipeImage = document.getElementById('recipe-image');
        const imagePreview = document.getElementById('image-preview');
        const previewImage = document.getElementById('preview-image');
        const videoDropzone = document.getElementById('video-dropzone');
        const tutorialVideo = document.getElementById('tutorial-video');
        const videoPreview = document.getElementById('video-preview');
        const videoPreviewElement = document.getElementById('video-preview-element');
        const prepTimeInput = document.getElementById('prep-time');
        const cookTimeInput = document.getElementById('cook-time');
        const notificationOverlay = document.getElementById('notificationOverlay');
        const notificationPanel = document.getElementById('notificationPanel');
        const recentNotifications = document.getElementById('recentNotifications');
        const earlierNotifications = document.getElementById('earlierNotifications');
        const messageOverlay = document.getElementById('messageOverlay');
        const messagePanel = document.getElementById('messagePanel');
        const messageSearch = document.getElementById('message-search');
        const messageList = document.getElementById('message-list');
        const messageAvatar = document.getElementById('message-avatar');
        const messageUserName = document.getElementById('message-user-name');
        const messageChat = document.getElementById('messageChat');
        const mediaInput = document.getElementById('mediaInput');
        const messageMediaBtn = document.getElementById('message-media-btn');
        const messageTextInput = document.getElementById('messageTextInput');
        const messageSendBtn = document.getElementById('message-send-btn');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        const searchBar = document.querySelector('.search-bar');
        const filterBtn = document.getElementById('filter-btn');
        const filterModal = document.getElementById('filter-modal');
        const closeFilterModal = document.getElementById('close-filter-modal');
        const filterForm = document.getElementById('filter-form');
        const filterIngredientsContainer = document.getElementById('filter-ingredients-container');
        const filterRatingSelect = document.getElementById('filter-rating');
        const clearFiltersBtn = document.getElementById('clear-filters');
        const activeFilters = document.getElementById('active-filters');
    
        // Initialize the app
        function init() {
            loadState();
            renderRecipes();
            renderNotifications();
            renderMessageList();
            renderActiveFilters();
            setupEventListeners();
            setupInfiniteScroll();
        }
    
        // Load state from localStorage
        function loadState() {
            const savedState = localStorage.getItem('appState');
            if (savedState) {
                const parsedState = JSON.parse(savedState);
                state = { ...state, ...parsedState };
                state.filteredRecipes = [...recipes];
                applyFilters();
            }
        }
    
        // Save state to localStorage
        function saveState() {
            localStorage.setItem('appState', JSON.stringify({
                currentCategory: state.currentCategory,
                searchIngredients: state.searchIngredients,
                minRating: state.minRating,
                selectedChatId: state.selectedChatId,
                newRecipeId: state.newRecipeId
            }));
        }
    
        // Debounce utility
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    
        // Render recipes
        function renderRecipes() {
            if (state.displayedRecipes <= 8) {
                recipeGrid.innerHTML = '';
            }
            const newRecipes = state.filteredRecipes.slice(recipeGrid.children.length, state.displayedRecipes);
            newRecipes.forEach(recipe => {
                const recipeCard = createRecipeCard(recipe);
                recipeGrid.appendChild(recipeCard);
            });
        }
    
        // Create recipe card
        function createRecipeCard(recipe) {
            const rating = recipe.rating || 0.0;
            const src = recipe.src || `recipe-details.html?id=${recipe.id}`;
            const card = document.createElement('div');
            card.className = 'recipe-card bg-white rounded-xl overflow-hidden shadow-md relative';
            card.dataset.id = recipe.id;
            card.dataset.category = recipe.category;
            card.innerHTML = `
                <a href="${src}"><img src="${recipe.image}" alt="${recipe.name}" class="w-full h-48 object-cover"></a>
                <div class="p-4">
                    <div class="flex justify-between items-start mb-2">
                        <a href="${src}"><h3 class="font-bold text-lg text-gray-800">${recipe.name}</h3></a>
                        <button class="save-btn text-gray-400 hover:text-red-500 ${recipe.saved ? 'saved' : ''}" aria-label="Save recipe">
                            <span class="${recipe.saved ? 'fas' : 'far'} fa-bookmark" role="img" aria-hidden="true"></span>
                        </button>
                    </div>
                    <p class="text-gray-600 text-sm mb-3">${recipe.description}</p>
                    <div class="flex items-center mb-2">
                        <div class="flex items-center ${rating > 0 ? 'text-yellow-400' : 'text-gray-400'} mr-2">
                            ${rating > 0 ? 
                                `${Array(Math.floor(rating)).fill('<span class="fas fa-star text-xs" role="img" aria-hidden="true"></span>').join('')}
                                ${rating % 1 >= 0.5 ? '<span class="fas fa-star-half-alt text-xs" role="img" aria-hidden="true"></span>' : ''}
                                ${Array(5 - Math.ceil(rating)).fill('<span class="far fa-star text-xs" role="img" aria-hidden="true"></span>').join('')}` :
                                Array(5).fill('<span class="far fa-star text-xs" role="img" aria-hidden="true"></span>').join('')
                            }
                            <span class="text-gray-500 text-xs ml-1">${rating.toFixed(1)}</span>
                        </div>
                        <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-full">${recipe.difficulty}</span>
                    </div>
                    <div class="flex justify-between items-center text-sm">
                        <div class="flex items-center text-gray-500">
                            <span class="fas fa-clock mr-1" role="img" aria-hidden="true"></span>
                            <span>${recipe.time}</span>
                        </div>
                        <div class="flex items-center text-gray-500">
                            <span class="fas fa-fire mr-1" role="img" aria-hidden="true"></span>
                            <span>${recipe.calories}</span>
                        </div>
                    </div>
                </div>
                <a href="User-Profile.html">
                    <div class="absolute top-3 right-3 bg-white rounded-full p-2 shadow-md">
                        <img src="${recipe.user.avatar}" alt="${recipe.user.name}" class="h-8 w-8 rounded-full">
                    </div>
                </a>
            `;
            return card;
        }
    
        // Apply filters (ingredients, rating, category)
        function applyFilters(query = '') {
            let filtered = [...recipes];
            if (state.currentCategory !== 'all') {
                filtered = filtered.filter(r => r.category === state.currentCategory);
            }
            if (query.trim()) {
                const searchTerm = query.toLowerCase();
                filtered = filtered.filter(r => 
                    r.name.toLowerCase().includes(searchTerm) || 
                    r.description.toLowerCase().includes(searchTerm)
                );
            }
            if (state.searchIngredients.length > 0) {
                filtered = filtered.filter(r => 
                    state.searchIngredients.every(ing => 
                        r.ingredients.some(ri => ri.toLowerCase().includes(ing.toLowerCase()))
                    )
                );
            }
            if (state.minRating > 0) {
                filtered = filtered.filter(r => r.rating >= state.minRating);
            }
            state.filteredRecipes = filtered;
            state.displayedRecipes = 8;
            renderRecipes();
        }
    
        // Filter recipes by category
        function filterRecipes(category) {
            state.currentCategory = category;
            applyFilters(searchBar.value);
            saveState();
        }
    
        // Search recipes with filters
        function searchRecipes(query) {
            applyFilters(query);
        }
    
        // Render active filters
        function renderActiveFilters() {
            activeFilters.innerHTML = '';
            state.searchIngredients.forEach(ing => {
                const tag = document.createElement('span');
                tag.className = 'filter-tag';
                tag.innerHTML = `${ing} <span class="fas fa-times remove-filter" data-type="ingredient" data-value="${ing}"></span>`;
                activeFilters.appendChild(tag);
            });
            if (state.minRating > 0) {
                const tag = document.createElement('span');
                tag.className = 'filter-tag';
                tag.innerHTML = `Rating ${state.minRating}+ <span class="fas fa-times remove-filter" data-type="rating"></span>`;
                activeFilters.appendChild(tag);
            }
        }
    
        // Toggle save recipe
        function toggleSaveRecipe(recipeId) {
            const recipe = recipes.find(r => r.id === recipeId);
            if (recipe) {
                recipe.saved = !recipe.saved;
                const card = document.querySelector(`.recipe-card[data-id="${recipeId}"]`);
                if (card) {
                    const saveBtn = card.querySelector('.save-btn');
                    const icon = saveBtn.querySelector('span');
                    saveBtn.classList.toggle('saved');
                    icon.classList.toggle('far');
                    icon.classList.toggle('fas');
                    showToast(recipe.saved ? 'Recipe saved!' : 'Recipe unsaved!');
                }
            }
        }
    
        // Render notifications
        function renderNotifications() {
            recentNotifications.innerHTML = '';
            earlierNotifications.innerHTML = '';
            const recent = notifications.filter(n => n.recent);
            const earlier = notifications.filter(n => !n.recent);
            recent.forEach(n => recentNotifications.appendChild(createNotificationItem(n)));
            earlier.forEach(n => earlierNotifications.appendChild(createNotificationItem(n)));
        }
    
        // Create notification item
        function createNotificationItem(notification) {
            const item = document.createElement('div');
            item.className = 'notification-item';
            item.dataset.id = notification.id;
            item.innerHTML = `
                <img src="${notification.user.avatar}" class="notification-avatar" alt="${notification.user.name}">
                <div class="notification-content">
                    <div class="notification-text">${notification.text}</div>
                    ${notification.comment ? `<div class="notification-comment">"${notification.comment}"</div>` : ''}
                    <div class="notification-time">${notification.time}</div>
                </div>
                ${notification.image ? `<img src="${notification.image}" class="notification-image">` : ''}
                <button class="notification-options-btn" aria-label="Notification options"><span class="fas fa-ellipsis-v" role="img" aria-hidden="true"></span></button>
                <div class="notification-options-menu">
                    <button class="reply">Reply</button>
                    <button class="remove">Remove</button>
                </div>
            `;
            return item;
        }
    
        // Render message list
        function renderMessageList(filter = '') {
            messageList.innerHTML = '';
            const filteredMessages = filter 
                ? messages.filter(m => m.user.name.toLowerCase().includes(filter.toLowerCase()))
                : messages;
            filteredMessages.forEach(m => {
                const item = document.createElement('div');
                item.className = `message-item ${m.id === state.selectedChatId ? 'active' : ''}`;
                item.dataset.id = m.id;
                item.innerHTML = `
                    <div class="message-avatar" style="background-image: url(${m.user.avatar})"></div>
                    <div class="message-info">
                        <div class="message-name">${m.user.name}</div>
                        <div class="message-preview">${m.preview}</div>
                    </div>
                    <div class="message-meta">
                        <div class="message-time">${m.time}</div>
                        ${m.unread ? `<div class="message-unread">${m.unread}</div>` : ''}
                    </div>
                `;
                messageList.appendChild(item);
            });
        }
    
        // Render chat
        function renderChat(chatId) {
            const chat = messages.find(m => m.id === chatId);
            if (!chat) {
                messageChat.innerHTML = '<div class="no-chat-selected">Who would you like to message?</div>';
                messageUserName.textContent = 'Select a chat';
                messageAvatar.style.backgroundImage = '';
                messageSendBtn.disabled = true;
                return;
            }
            state.selectedChatId = chatId;
            messageUserName.textContent = chat.user.name;
            messageAvatar.style.backgroundImage = `url(${chat.user.avatar || 'https://randomuser.me/api/portraits/lego/1.jpg'})`;
            messageChat.innerHTML = '';
            chat.chat.forEach(msg => {
                const bubble = document.createElement('div');
                bubble.className = `message-bubble ${msg.own ? 'own-message' : 'other-message'}`;
                bubble.innerHTML = `
                    <div class="message-text">${msg.text}</div>
                    ${msg.media ? `<img src="${msg.media}" class="message-media">` : ''}
                    <div class="message-timestamp">${msg.timestamp}</div>
                `;
                messageChat.appendChild(bubble);
            });
            messageChat.scrollTop = messageChat.scrollHeight;
            chat.unread = 0;
            renderMessageList();
            messageSendBtn.disabled = false;
            saveState();
        }
    
        // Send message
        function sendMessage(text, media = null) {
            if (!state.selectedChatId || !text) return;
            const chat = messages.find(m => m.id === state.selectedChatId);
            const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const message = { text, timestamp, own: true };
            if (media) message.media = media;
            chat.chat.push(message);
            chat.preview = text.length > 30 ? text.substring(0, 30) + '...' : text;
            chat.time = timestamp;
            renderChat(state.selectedChatId);
            messageTextInput.value = '';
            mediaInput.value = '';
            showToast('Message sent!');
        }
    
        // Show toast
        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            toast.className = `toast fixed bottom-4 left-1/2 transform -translate-x-1/2 ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white px-4 py-2 rounded-md shadow-lg show`;
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    
        // Handle file upload
        function handleFileUpload(input, previewElement, previewContainer) {
            if (input.files && input.files.length) {
                const file = input.files[0];
                if (file.type.match('image.*') || file.type.match('video.*')) {
                    const reader = new FileReader();
                    reader.onload = e => {
                        previewElement.src = e.target.result;
                        previewContainer.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                } else {
                    showToast('Please upload a valid image or video.', 'error');
                }
            }
        }
    
        // Add ingredient for recipe creation
        function addIngredient() {
            const container = document.getElementById('ingredients-container');
            if (container.children.length >= 50) {
                showToast('Maximum 50 ingredients allowed', 'error');
                return;
            }
            const newIngredient = document.createElement('div');
            newIngredient.className = 'ingredient-item';
            newIngredient.innerHTML = `
                <input type="text" name="ingredient" placeholder="e.g., 2 cups flour" 
                    class="ingredient-input px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" aria-required="true">
                <span class="fas fa-times remove-ingredient" role="button" aria-label="Remove ingredient"></span>
            `;
            container.appendChild(newIngredient);
        }
    
        // Remove ingredient for recipe creation
        function removeIngredient(element) {
            const container = document.getElementById('ingredients-container');
            if (container.children.length > 1) {
                element.parentElement.remove();
            } else {
                showToast('At least one ingredient is required', 'error');
            }
        }
    
        // Add filter ingredient
        function addFilterIngredient() {
            const container = filterIngredientsContainer;
            if (container.children.length >= 10) {
                showToast('Maximum 10 ingredients allowed', 'error');
                return;
            }
            const newIngredient = document.createElement('div');
            newIngredient.className = 'filter-ingredient-item';
            newIngredient.innerHTML = `
                <input type="text" name="filter-ingredient" placeholder="e.g., avocado" 
                    class="filter-ingredient-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                <span class="fas fa-times remove-filter-ingredient" role="button" aria-label="Remove ingredient"></span>
            `;
            container.appendChild(newIngredient);
            updateFilterIngredientRemoveButtons();
        }
    
        // Remove filter ingredient
        function removeFilterIngredient(element) {
            const container = filterIngredientsContainer;
            if (container.children.length > 1) {
                element.parentElement.remove();
                updateFilterIngredientRemoveButtons();
            } else {
                showToast('At least one ingredient field is required', 'error');
            }
        }
    
        // Update visibility of remove buttons in filter ingredients
        function updateFilterIngredientRemoveButtons() {
            const items = filterIngredientsContainer.querySelectorAll('.filter-ingredient-item');
            items.forEach((item, index) => {
                const removeBtn = item.querySelector('.remove-filter-ingredient');
                removeBtn.classList.toggle('hidden', index === 0);
            });
        }
    
        // Setup infinite scroll
        function setupInfiniteScroll() {
            const observer = new IntersectionObserver(entries => {
                if (entries[0].isIntersecting && state.displayedRecipes < state.filteredRecipes.length) {
                    state.displayedRecipes += 4;
                    renderRecipes();
                    showToast(`${Math.min(4, state.filteredRecipes.length - state.displayedRecipes + 4)} more recipes loaded!`);
                }
            }, { threshold: 0.1 });
            observer.observe(infiniteScrollRoot);
        }
    
        // Setup event listeners
        function setupEventListeners() {
            userMenu.addEventListener('click', e => {
                e.stopPropagation();
                userDropdown.classList.toggle('hidden');
            });
            filterForm.addEventListener('click', e => {
            if (e.target.classList.contains('add-filter-ingredient')) {
                addFilterIngredient();
            }
        });
            document.addEventListener('click', () => userDropdown.classList.add('hidden'));
            categoryBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    categoryBtns.forEach(b => {
                        b.classList.remove('active');
                        b.setAttribute('aria-selected', 'false');
                    });
                    btn.classList.add('active');
                    btn.setAttribute('aria-selected', 'true');
                    filterRecipes(btn.dataset.category);
                });
            });
            createBtn.addEventListener('click', () => {
                createModal.classList.add('active');
            });
            closeModal.addEventListener('click', closeCreateModal);
            cancelRecipe.addEventListener('click', closeCreateModal);
            createModal.addEventListener('click', e => {
                if (e.target === createModal) closeCreateModal();
            });
            function closeCreateModal() {
                createModal.classList.remove('active');
                recipeForm.reset();
                imagePreview.classList.add('hidden');
                videoPreview.classList.add('hidden');
                const ingredientsContainer = document.getElementById('ingredients-container');
                ingredientsContainer.innerHTML = `
                    <div class="ingredient-item">
                        <input type="text" name="ingredient" placeholder="e.g., 2 cups flour" 
                            class="ingredient-input px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" aria-required="true">
                        <span class="fas fa-times remove-ingredient" role="button" aria-label="Remove ingredient"></span>
                    </div>
                `;
            }
            
            recipeForm.addEventListener('submit', e => {
                e.preventDefault();
                const ingredientInputs = document.querySelectorAll('.ingredient-input');
                const ingredients = Array.from(ingredientInputs).map(input => input.value.trim()).filter(val => val);
                if (ingredients.length === 0) {
                    showToast('Please add at least one ingredient', 'error');
                    return;
                }
                const name = document.getElementById('recipe-name').value;
                const description = document.getElementById('recipe-description').value;
                const category = document.getElementById('recipe-category').value;
                const prepTime = prepTimeInput.value;
                const cookTime = cookTimeInput.value;
                const calories = document.getElementById('recipe-calories').value || '400';
                const difficulty = document.getElementById('recipe-difficulty').value;
                if (!name || !description || !prepTime || !cookTime) {
                    showToast('Please fill in all required fields.', 'error');
                    return;
                }
                const prepTimeNum = parseInt(prepTime.replace(/[^0-9]/g, '')) || 0;
                const cookTimeNum = parseInt(cookTime.replace(/[^0-9]/g, '')) || 0;
                if (isNaN(prepTimeNum) || isNaN(cookTimeNum)) {
                    showToast('Please enter valid time values (e.g., "20min")', 'error');
                    return;
                }
                const totalTime = `${prepTimeNum + cookTimeNum} min`;
                const newRecipe = {
                    id: state.newRecipeId++,
                    name,
                    description,
                    image: previewImage.src || 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&w=880&q=80',
                    time: totalTime,
                    calories: `${calories} cal`,
                    category,
                    difficulty,
                    rating: 0.0,
                    ingredients,
                    user: { name: "You", avatar: "https://randomuser.me/api/portraits/women/44.jpg" },
                    saved: false,
                    prepTime,
                    cookTime
                };
                recipes.unshift(newRecipe);
                closeCreateModal();
                filterRecipes(state.currentCategory);
                showToast('Recipe shared successfully!');
                saveState();
            });
            dropzone.addEventListener('click', () => recipeImage.click());
            recipeImage.addEventListener('change', () => handleFileUpload(recipeImage, previewImage, imagePreview));
            dropzone.addEventListener('dragover', e => {
                e.preventDefault();
                dropzone.classList.add('active');
            });
            dropzone.addEventListener('dragleave', () => dropzone.classList.remove('active'));
            dropzone.addEventListener('drop', e => {
                e.preventDefault();
                dropzone.classList.remove('active');
                if (e.dataTransfer.files.length) {
                    recipeImage.files = e.dataTransfer.files;
                    handleFileUpload(recipeImage, previewImage, imagePreview);
                }
            });
            videoDropzone.addEventListener('click', () => tutorialVideo.click());
            tutorialVideo.addEventListener('change', () => handleFileUpload(tutorialVideo, videoPreviewElement, videoPreview));
            videoDropzone.addEventListener('dragover', e => {
                e.preventDefault();
                videoDropzone.classList.add('active');
            });
            videoDropzone.addEventListener('dragleave', () => videoDropzone.classList.remove('active'));
            videoDropzone.addEventListener('drop', e => {
                e.preventDefault();
                videoDropzone.classList.remove('active');
                if (e.dataTransfer.files.length) {
                    tutorialVideo.files = e.dataTransfer.files;
                    handleFileUpload(tutorialVideo, videoPreviewElement, videoPreview);
                }
            });
            document.getElementById('ingredients-container').addEventListener('click', e => {
                if (e.target.classList.contains('remove-ingredient')) {
                    removeIngredient(e.target);
                }
            });
            document.querySelector('.add-ingredient').addEventListener('click', addIngredient);
            filterBtn.addEventListener('click', () => {
                filterModal.classList.add('active');
                // Populate filter ingredients
                filterIngredientsContainer.innerHTML = `
                    <div class="filter-ingredient-item">
                        <input type="text" name="filter-ingredient" placeholder="e.g., avocado" 
                            class="filter-ingredient-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                        <span class="fas fa-times remove-filter-ingredient hidden" role="button" aria-label="Remove ingredient"></span>
                    </div>
                `;
                state.searchIngredients.forEach((ing, index) => {
                    if (index > 0) addFilterIngredient();
                    const inputs = filterIngredientsContainer.querySelectorAll('.filter-ingredient-input');
                    inputs[index].value = ing;
                });
                filterRatingSelect.value = state.minRating;
                updateFilterIngredientRemoveButtons();
            });
            closeFilterModal.addEventListener('click', closeFilterModalFn);
            filterModal.addEventListener('click', e => {
                if (e.target === filterModal) closeFilterModalFn();
            });
            function closeFilterModalFn() {
                filterModal.classList.remove('active');
                filterForm.reset();
                filterIngredientsContainer.innerHTML = `
                    <div class="filter-ingredient-item">
                        <input type="text" name="filter-ingredient" placeholder="e.g., avocado" 
                            class="filter-ingredient-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                        <span class="fas fa-times remove-filter-ingredient hidden" role="button" aria-label="Remove ingredient"></span>
                    </div>
                `;
            }
            filterForm.addEventListener('submit', e => {
                e.preventDefault();
                const ingredientInputs = filterIngredientsContainer.querySelectorAll('.filter-ingredient-input');
                state.searchIngredients = Array.from(ingredientInputs)
                    .map(input => input.value.trim())
                    .filter(val => val);
                state.minRating = parseFloat(filterRatingSelect.value) || 0;
                applyFilters(searchBar.value);
                renderActiveFilters();
                closeFilterModalFn();
                saveState();
            });
            clearFiltersBtn.addEventListener('click', () => {
                state.searchIngredients = [];
                state.minRating = 0;
                filterForm.reset();
                filterIngredientsContainer.innerHTML = `
                    <div class="filter-ingredient-item">
                        <input type="text" name="filter-ingredient" placeholder="e.g., avocado" 
                            class="filter-ingredient-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                        <span class="fas fa-times remove-filter-ingredient hidden" role="button" aria-label="Remove ingredient"></span>
                    </div>
                `;
                applyFilters(searchBar.value);
                renderActiveFilters();
                saveState();
            });
            searchBar.addEventListener('input', debounce(e => searchRecipes(e.target.value), 300));
            recipeGrid.addEventListener('click', e => {
                const saveBtn = e.target.closest('.save-btn');
                if (saveBtn) {
                    const recipeId = parseInt(saveBtn.closest('.recipe-card').dataset.id);
                    toggleSaveRecipe(recipeId);
                }
            });
            notificationBtn.addEventListener('click', () => {
                notificationPanel.classList.toggle('active');
                notificationOverlay.classList.toggle('active');
            });
            notificationOverlay.addEventListener('click', () => {
                notificationPanel.classList.remove('active');
                notificationOverlay.classList.remove('active');
            });
            notificationPanel.addEventListener('click', e => {
                const optionsBtn = e.target.closest('.notification-options-btn');
                if (optionsBtn) {
                    const menu = optionsBtn.nextElementSibling;
                    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
                }
                const replyBtn = e.target.closest('.reply');
                if (replyBtn) {
                    const notificationId = replyBtn.closest('.notification-item').dataset.id;
                    showToast(`Replying to notification ${notificationId}`, 'success');
                }
                const removeBtn = e.target.closest('.remove');
                if (removeBtn) {
                    const notificationId = parseInt(removeBtn.closest('.notification-item').dataset.id);
                    const index = notifications.findIndex(n => n.id === notificationId);
                    if (index !== -1) {
                        notifications.splice(index, 1);
                        renderNotifications();
                        showToast('Notification removed!');
                    }
                }
            });
            messageBtn.addEventListener('click', () => {
                messagePanel.classList.toggle('active');
                messageOverlay.classList.toggle('active');
                if (state.selectedChatId) renderChat(state.selectedChatId);
            });
            messageOverlay.addEventListener('click', () => {
                messagePanel.classList.remove('active');
                messageOverlay.classList.remove('active');
            });
            messageList.addEventListener('click', e => {
                const item = e.target.closest('.message-item');
                if (item) {
                    const chatId = parseInt(item.dataset.id);
                    renderChat(chatId);
                }
            });
            messageSearch.addEventListener('input', e => renderMessageList(e.target.value));
            messageTextInput.addEventListener('input', () => {
                messageSendBtn.disabled = !messageTextInput.value.trim();
            });
            messageSendBtn.addEventListener('click', () => {
                sendMessage(messageTextInput.value);
            });
            messageTextInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault(); // Prevent adding a new line
            const text = messageTextInput.value.trim();
            if (text) {
                sendMessage(text);
            }
        }
    });

            messageMediaBtn.addEventListener('click', () => mediaInput.click());
            mediaInput.addEventListener('change', () => {
                if (mediaInput.files.length) {
                    const file = mediaInput.files[0];
                    if (file.type.match('image.*') || file.type.match('video.*')) {
                        const reader = new FileReader();
                        reader.onload = e => sendMessage(messageTextInput.value || 'Media', e.target.result);
                        reader.readAsDataURL(file);
                    } else {
                        showToast('Please upload a valid image or video.', 'error');
                    }
                }
            });
            activeFilters.addEventListener('click', e => {
                const removeFilter = e.target.closest('.remove-filter');
                if (removeFilter) {
                    const type = removeFilter.dataset.type;
                    if (type === 'ingredient') {
                        const value = removeFilter.dataset.value;
                        state.searchIngredients = state.searchIngredients.filter(ing => ing !== value);
                    } else if (type === 'rating') {
                        state.minRating = 0;
                    }
                    applyFilters(searchBar.value);
                    renderActiveFilters();
                    saveState();
                }
            });
        }
    
        // Initialize app
        init();
    </script>
    </body>
    </html>